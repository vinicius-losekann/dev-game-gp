<!-- index.html -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="main_page_title">Jogo de Gerenciamento de Projetos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Importa seu arquivo de estilo CSS personalizado -->
    <link rel="stylesheet" href="css/style.css"> 
</head>
<body>
    <div id="main-content-container" class="container">
        <h1 data-lang-key="main_title">Jogo de Gerenciamento de Projetos</h1>
        <p class="text-gray-700 mb-6 leading-relaxed" data-lang-key="description_text">
            Domine as habilidades essenciais de gerenciamento de projetos neste jogo interativo! Aprenda sobre **planejamento**, **execução**, **monitoramento de progresso** e **resolução de desafios** em cenários simulados para se tornar um gestor de projetos de sucesso. Cada decisão importa!
        </p>

        <!-- Seção de Seleção de Idioma -->
        <div class="select-group mb-6">
            <h2 class="text-xl font-semibold mb-3" data-lang-key="language_select_title">Selecione o Idioma:</h2>
            <!-- Contêiner para os botões de idioma -->
            <div id="languageSelectorButtonsContainer" class="flex justify-center gap-4 mb-6 flex-wrap">
                <button id="langPtBrButton" class="game-button lang-button bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg" data-lang="pt-BR" data-lang-key="lang_pt_br">Português (Brasil)</button>
                <button id="langEnUsButton" class="game-button lang-button bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg" data-lang="en-US" data-lang-key="lang_en_us">English (US)</button>
                <button id="langEsEsButton" class="game-button lang-button bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg" data-lang="es-ES" data-lang-key="lang_es_es">Español (España)</button>
            </div>
        </div>

        <!-- Seção de Novo Jogo -->
        <div class="input-group mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
            <h2 class="text-xl font-semibold mb-3 text-blue-800" data-lang-key="new_game_title">Iniciar Novo Jogo</h2>
            <button id="newGameButton" class="game-button bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg w-full max-w-xs mx-auto">
                <span data-lang-key="button_new_game">Iniciar Novo Jogo</span>
            </button>
        </div>

        <!-- Seção de Acesso a Jogo Existente ou Recém-Criado -->
        <div class="input-group mb-6 p-4 border border-purple-200 rounded-lg bg-purple-50">
            <h2 class="text-xl font-semibold mb-3 text-purple-800" data-lang-key="access_game_title">Acessar Jogo Existente</h2>
            
            <!-- Mensagem de feedback e ID da sessão criada (visível após "Iniciar Novo Jogo") -->
            <div id="sessionInfo" class="session-info hidden bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative mb-4">
                <p><strong data-lang-key="session_created_message">Sessão criada! Seu ID é: </strong> <span id="displayCreatedSessionId" class="font-bold text-lg"></span></p>
                <p class="mt-2 text-sm mb-4" data-lang-key="session_id_prompt">Insira este ID no campo abaixo, seu nome e clique em "Acessar Jogo".</p>
                
                <button id="copySessionIdButton" class="game-button mt-2 mb-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg shadow-md">
                    <span data-lang-key="button_copy_id">Copiar ID</span>
                </button>
            </div>

            <input type="text" id="sessionIdInput" placeholder="Digite o ID da Sessão (Ex: 1234)" class="input-field mb-4 p-3 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500" data-lang-key="input_session_placeholder">
            <input type="text" id="accessPlayerNameInput" placeholder="Seu nome de identificação (Ex: João)" class="input-field mb-4 p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" data-lang-key="input_player_name_placeholder">
            <button id="accessGameButton" class="game-button bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg w-full max-w-xs mx-auto">
                <span data-lang-key="button_access_game">Acessar Jogo</span>
            </button>
        </div>
        
        <!-- Mensagem de feedback geral (usada para erros, etc.) -->
        <div id="messageBox" class="message-box hidden px-4 py-3 rounded-lg text-sm mb-4"></div>

        <!-- Rodapé com Versão -->
        <div class="version-footer" data-lang-key="app_version">Versão 1.0.0</div>
    </div>

    <!-- Script de Configuração do Firebase e AppConfig -->
    <script src="js/config.js"></script>
    <script type="module">
        // Importa as funções necessárias do Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, doc, getDoc, setDoc, updateDoc, arrayRemove, arrayUnion, serverTimestamp, collection, addDoc 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Promessa que será resolvida quando o Firebase estiver inicializado e autenticado
        window.firebaseInitializedPromise = new Promise(async (resolve) => {
            try {
                // Verifica se firebaseConfig está definido globalmente (do config.js)
                if (window.firebaseConfig && Object.keys(window.firebaseConfig).length > 0) {
                    const appInstance = initializeApp(window.firebaseConfig);
                    const authInstance = getAuth(appInstance);
                    const dbInstance = getFirestore(appInstance);

                    // Expõe as instâncias do Firebase e funções para outros scripts
                    window.app = appInstance;
                    window.auth = authInstance;
                    window.db = dbInstance;
                    window.firestore = { 
                        doc, getDoc, setDoc, updateDoc, arrayRemove, arrayUnion, serverTimestamp, collection, addDoc 
                    }; 

                    // Autenticação: tenta com token customizado primeiro, depois anonimamente.
                    if (window.initialAuthToken) {
                        await signInWithCustomToken(authInstance, window.initialAuthToken);
                        console.log("Firebase (index.html): Autenticado com token personalizado.");
                    } else {
                        await signInAnonymously(authInstance);
                        console.log("Firebase (index.html): Autenticado anonimamente.");
                    }

                    // Define o userId globalmente após a autenticação
                    window.currentUserId = authInstance.currentUser?.uid || `anon-${crypto.randomUUID()}`;
                    console.log("UserID definido:", window.currentUserId);

                    resolve();
                } else {
                    console.error("Firebase: Configuração não encontrada ou inválida. Pulando inicialização.");
                    resolve();
                }
            } catch (error) {
                console.error("Erro na inicialização ou autenticação do Firebase:", error);
                resolve(); // Resolve mesmo em caso de erro para não bloquear DOMContentLoaded
            }
        });

        // Opcional: listener para mudanças de estado de autenticação
        onAuthStateChanged(window.auth, (user) => { // Use window.auth aqui
            if (user) {
                console.log("onAuthStateChanged: Usuário logado:", user.uid);
            } else {
                console.log("onAuthStateChanged: Usuário deslogado.");
            }
        });
    </script>
    <!-- Carrega o script principal do jogo (index.js) com type="module" se ele importar outras coisas -->
    <script src="js/index.js" type="module"></script>
</body>
</html>

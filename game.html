<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title> <!-- Título vazio, será definido via JS -->
    <!-- Incluindo Tailwind CSS para estilização moderna e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluindo estilos personalizados -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="p-4 flex flex-col min-h-screen">
    <div class="w-full max-w-5xl flex justify-between items-center mb-6">
        <h1 class="text-3xl font-extrabold text-teal-700">
            <span id="labelSession">Sessão</span>: <span id="sessionIdDisplay" class="text-green-600"></span>
        </h1>
        <button id="backToHomeButton" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg shadow">
            <span id="labelBackToHome">Voltar para o Início</span>
        </button>
    </div>

    <div class="flex-grow flex items-center justify-center p-4"> 
        <div id="areaSelector" class="game-area-selector hidden">
            <h2 id="labelChooseArea" class="text-3xl font-bold text-gray-800 mb-6">Escolha a Área da Próxima Carta:</h2>
            <div class="mt-8 flex flex-col items-center gap-3">
                <!-- ATENÇÃO: Os data-area devem corresponder aos valores do campo 'area' nos seus documentos do Firestore -->
                <button data-area="Integração" class="area-select-button bg-teal-500 text-white py-3 px-6 text-base shadow-md w-full max-w-sm"><span data-lang-key="area_integration">Integração</span></button>
                <button data-area="Escopo" class="area-select-button bg-teal-500 text-white py-3 px-6 text-base shadow-md w-full max-w-sm"><span data-lang-key="area_scope">Escopo</span></button>
                <button data-area="Cronograma" class="area-select-button bg-teal-500 text-white py-3 px-6 text-base shadow-md w-full max-w-sm"><span data-lang-key="area_schedule">Cronograma</span></button>
                <button data-area="Custos" class="area-select-button bg-teal-500 text-white py-3 px-6 text-base shadow-md w-full max-w-sm"><span data-lang-key="area_cost">Custos</span></button>
                <button data-area="Qualidade" class="area-select-button bg-teal-500 text-white py-3 px-6 text-base shadow-md w-full max-w-sm"><span data-lang-key="area_quality">Qualidade</span></button>
                <button data-area="Recursos" class="area-select-button bg-teal-500 text-white py-3 px-6 text-base shadow-md w-full max-w-sm"><span data-lang-key="area_resources">Recursos</span></button>
                <button data-area="Comunicações" class="area-select-button bg-teal-500 text-white py-3 px-6 text-base shadow-md w-full max-w-sm"><span data-lang-key="area_communications">Comunicações</span></button>
                <button data-area="Riscos" class="area-select-button bg-teal-500 text-white py-3 px-6 text-base shadow-md w-full max-w-sm"><span data-lang-key="area_risks">Riscos</span></button>
                <button data-area="Aquisições" class="area-select-button bg-teal-500 text-white py-3 px-6 text-base shadow-md w-full max-w-sm"><span data-lang-key="area_acquisitions">Aquisições</span></button>
                <button data-area="Partes Interessadas" class="area-select-button bg-teal-500 text-white py-3 px-6 text-base shadow-md w-full max-w-sm"><span data-lang-key="area_stakeholders">Partes Interessadas</span></button>
                <button id="randomAreaButtonSelector" class="area-select-button bg-gray-600 hover:bg-gray-700 text-white py-3 px-6 text-base shadow-md w-full max-w-sm"><span data-lang-key="button_random_card">Carta Aleatória</span></button>
            </div>
        </div>

        <div id="gameCard" class="card hidden">
            <div class="card-content">
                <h2 id="questionArea" class="text-3xl font-extrabold text-teal-700 mb-4"></h2>
                <p id="questionText" class="text-xl text-gray-800 mb-6 leading-relaxed"></p>
                <div id="optionsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <!-- As opções de resposta serão carregadas aqui -->
                </div>
                <button id="submitAnswerButton" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg text-lg opacity-50 cursor-not-allowed" disabled>
                    <span data-lang-key="button_check_answer">Verificar Resposta</span>
                </button>
                <div id="feedbackContainer" class="mt-6">
                    <!-- Feedback e explicação serão exibidos aqui -->
                </div>
                <button id="nextCardButton" class="hidden mt-4 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg text-lg">
                    <span data-lang-key="button_next_card">Próxima Carta</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Indicador de Versão (agora no final do fluxo, empurrado pelo flex-grow) -->
    <div id="app-version" class="mt-auto text-gray-400 text-xs p-4 text-center w-full">
        Versão: 1.0.0
    </div>

    <!-- INICIALIZAÇÃO DO FIREBASE (DEVE VIR ANTES DOS SEUS SCRIPTS JS) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { 
            getFirestore, collection, doc, getDoc, setDoc, updateDoc, 
            onSnapshot, serverTimestamp, arrayUnion, arrayRemove,
            query, where, getDocs // Adicionando importação de query, where, getDocs
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        // import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js"; // Descomente se precisar de Analytics

        // Configurações do Firebase (use as suas, se forem diferentes)
        const firebaseConfig = {
            apiKey: "AIzaSyDdiedj1Smjzn9CDqShdhG5Y0_Sa18xyWI",
            authDomain: "jogo-gerencia-de-projetos.firebaseapp.com",
            projectId: "jogo-gerencia-de-projetos",
            storageBucket: "jogo-gerencia-de-projetos.firebasestorage.app",
            messagingSenderId: "356867532123",
            appId: "1:356867532123:web:0657d84635a5849df2667e",
            measurementId: "G-M5QYQ36Q9P"
        };

        // Use o __app_id fornecido pelo ambiente, se existir, senão use o projectId
        const finalAppId = typeof __app_id !== 'undefined' ? __app_id : firebaseConfig.projectId; 

        // Expõe instâncias e funções do Firebase globalmente
        window.firebaseApp = initializeApp(firebaseConfig);
        // window.analytics = getAnalytics(window.firebaseApp); // Inicializa Analytics, se precisar
        window.auth = getAuth(window.firebaseApp);
        window.db = getFirestore(window.firebaseApp);
        window.appId = finalAppId;

        // Expõe funções Firestore para uso mais direto no game.js
        window.firestore = {
            collection: collection,
            doc: doc,
            getDoc: getDoc,
            setDoc: setDoc,
            updateDoc: updateDoc,
            onSnapshot: onSnapshot,
            serverTimestamp: serverTimestamp,
            arrayUnion: arrayUnion,
            arrayRemove: arrayRemove,
            query: query, // Expondo query
            where: where,   // Expondo where
            getDocs: getDocs // Expondo getDocs
        };

        // Define a promessa que será resolvida quando o Firebase estiver pronto
        window.firebaseInitializedPromise = new Promise(async (resolve, reject) => {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(window.auth, __initial_auth_token);
                    console.log("Firebase: Autenticado com token customizado em game.html.");
                } else {
                    await signInAnonymously(window.auth);
                    console.log("Firebase: Autenticado anonimamente em game.html.");
                }
                window.currentUserId = window.auth.currentUser?.uid || 'anonymous-user';
                console.log("Firebase: App inicializado e autenticado em game.html. ID do Usuário:", window.currentUserId);
                resolve(); // Resolve a promessa indicando que Firebase está pronto

            } catch (error) {
                console.error("Erro ao inicializar Firebase ou autenticar em game.html:", error);
                alert("Erro ao iniciar o jogo. Por favor, tente novamente.");
                window.location.href = 'index.html?error=firebase_init_failed';
                reject(error); // Rejeita a promessa em caso de erro
            }
        });

    </script>

    <!-- Seus scripts JS devem vir DEPOIS da inicialização do Firebase -->
    <script src="js/config.js"></script>
    <script src="js/game.js"></script>
</body>
</html>
